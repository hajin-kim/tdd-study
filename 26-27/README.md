# 26-27

## 26장. 빨간 막대 패턴

### 한 단계 테스트

여러 할 일(테스트할 사항)이 있다면, 구현이 가능하다고 확신하는 것 중 아무거나 고릅시다.

- 하향식, 상향식은 시간에 따른 수직적 메타포이며, 올바른 구분이 아닌 것 같습니다.
- 프로그램의 성장에 초점을 두고, "아는 것에서 모르는 것으로"

### 시작 테스트

아무 것도 하지 않는 동작을 먼저 테스트합니다.

- 한 번에 한 문제만 해결하기, 즉 다른 질문은 다 제외하고 하나만 생각하는 것이 유리합니다.
- "이 오퍼레이션을 어디에 두어야 하는가"라는 질문에만 집중할 방법입니다.
- 피드백(사이클)이 빠릅니다.

가장 단순한 입력과 출력을 먼저 테스트합니다.

- 예컨대 항등원이나, 쉽고 간단한 엣지 케이스를 먼저 테스트합니다.

### 설명 테스트

- 테스트를 통해 설명하고, 테스트를 통해 설명을 요청(질문)합시다.

### 학습 테스트

- 외부 패키지나 라이브러리를 학습하는 용도로 쓸 수 있습니다.
- 그것에 대한 작은 테스트를 만들어서, 예상한대로 작동하는지 확인합니다. 필요하다면 수정합니다.
- 테스트가 통과한다면 그때 애플리케이션을 실행해봅니다.

### 또 다른 테스트

- 지금 작업하는 주제와 관련이 없는 아이디어가 떠오르면, 할 일 목록에 적어두고 지금은 다시 돌아옵니다.

### 회귀 테스트

- 장애가 발생했다면 그것을 재현하는 테스트를 작성합니다.
- 후에 회귀 테스트로 사용하여, 재발하지 않도록 합니다.
- 애플리케이션 수준에서 진행하면 사용자의 기대를 충족하는지 평가하는데 좋고, 작은 차원에서 진행하면 테스트 개선(향후 어떤 것들을 신경써서 테스트할지 학습)에 좋습니다.
- 시스템 장애 격리가 어렵다면 리팩토링을 진행합니다. 아직 설계가 끝나지 않았다는 뜻입니다.

### 휴식

- 테스트를 작성하다가 지친다면, 휴식을 취합시다.
- 아이디어가 나올 수도 있습니다.
- 샤워 방법론 (Dave Ungar)
- 잘 모르겠다면 가짜 구현을, 설계가 올바르지 않은 것 같다면 삼각측량을, 그래도 모른다면 차라리 샤워하러 갑시다.
- 피로는 판단력 저하를, 이는 다시 피로를 초래하는 악순환이 될 수 있습니다.

### 다시 하기

- 길을 잃었다면 하던 작업을 다 지우고 다시 시작합시다.

### 싸구려 책상, 좋은 의자

- 허리는 소중합니다.
- 여차하면 돈을 투자해서 좋은 환경을 만듭시다.

## 27장. 테스팅 패턴

### 자식 테스트

- 큰 테스트를 생각 또는 작업중이면, 빨간 막대를 유발하는 부분만 떼서 작은 테스트를 먼저 만듭시다. 그것을 통과시킨 후에 원래의 큰 테스트를 만듭니다.

### 모의 객체(mock object)

- 상수만 반환하는 가짜 버전 객체입니다.
- 데이터베이스처럼, 셋업이 어렵거나 외적 요인이 많은 리소스에 대해 유용합니다.
- 또한 가독성이 향상됩니다.

### 셀프 션트(self shunt)

- 두 객체, 즉 테스트할 객체(A)와 다른 객체(B) 사이의 상호작용을 테스트하기 위함입니다.
- 테스트 케이스 자체를 상호작용할 객체(B)로 만들어서, 대상 객체(A)가 셀프 션트(B)와 올바르게 상호작용하는지 테스트합니다.
- 인터페이스를 추출하면 여러 곳에서 쓰일 것입니다.

### 로그 문자열

- 메서드의 호출 순서가 올바른지 궁금하다면, 로그 문자열을 만들어서 중간중간 append해둡시다. 그리고 마지막에 한 번에 출력합니다.
- 옵저버 구현이나, 이벤트 오가는 것의 순서 확인에 유용합니다.
- (아마 중단점의 대안으로 보입니다.)

### 크래시 테스트 더미

- 잘 발생하지 않을 법한 예외를 테스트해야 한다면, 그 예외를 무조건 던지는 테스트(mock) 객체를 만듭시다.
- 예외 상황이 아주 많다면, 그중 발생하더라도 정상적으로 작동해야 하는 예외들만은 테스트합시다.
- 자바의 익명 클래스를 사용하면 좋습니다.

### 깨진 테스트

- 혼자서 한다면, 그 업무 세션이 끝났을 때(회의, 휴식, 퇴근 등) 테스트를 깨뜨려둡시다.
- 책갈피 역할을 합니다. 돌아왔을 때 무엇을 해야 할지 알려줍니다.
- 프로그램의 완성도가 줄어든다는 의미가 아니니 걱정하지 마세요. 단지 프로그램의 상태를 드러내줄 뿐입니다.

### 깨끗한 체크인

- 협업을 한다면, 모든 테스트가 통과하는 상태로 체크아웃합시다.
- 다른 사람이 체크인했을 때, 그 사람의 환경에서 테스트가 성공하는 상태여야 합니다.
- 정 안 된다면 코드를 다 지우고 다시 시작합시다.
- 혹은 무식한 방법은, 그냥 고칩시다. (될 때까지 구르던지, 구르다가 포기하게 되던지 그런 의미인 것 같습니다.)
- 테스트를 깨뜨리고 체크아웃하면, 팀원들한테 맥주를 사줘야 하게 될 수도 있습니다.
